---
layout: default
---

<style>
  .img-cover {
    aspect-ratio: 1 / 1;
    width: 100%;
    height: 100%;
  }
</style>

<div class="grid grid-cols-5 gap-3">
  {% set postslist = collections.work | sortByWeight %}

  {% for post in postslist %}
  <a href="/test/{{ post.data.page.fileSlug | url }}">
    <img class="img-cover object-cover" data-src="{{post.data.cover}}" />

    <span class="hidden">-- {{post.data.weight}}</span>
  </a>
  {% endfor %}
</div>


<script type="text/javascript">
  let options = {
    rootMargin: "0px",
    threshold: 1.0,
  };

  const callback = (entries, observer) => {
    const inView = entries.filter((e) => e.isIntersecting);
    const shuffledArray = inView.sort((a, b) => 0.5 - Math.random());

    shuffledArray.map((element, index) => {
      if (!element.isIntersecting) return;
      observer.unobserve(element.target);
      console.log(index);
      setTimeout(() => {
        console.log(element.target.getAttribute("data-src"));
        element.target.setAttribute(
          "src",
          element.target.getAttribute("data-src")
        );
      }, 500 * index + 200);
    });
  };

  let observer = new IntersectionObserver(callback, options);

  document.querySelectorAll(".img-cover").forEach((element) => {
    observer.observe(element)
  });

</script>
